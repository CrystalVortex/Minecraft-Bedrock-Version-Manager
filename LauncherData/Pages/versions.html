<!DOCTYPE html>
<html>
<head>
    <title>Versions</title>
    <style>
        body {
            background-color: black;
            color: white;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        .version-card {
            background-color: #202020;
            color: white;
            border-radius: 5px;
            padding: 10px;
            margin: 10px;
            width: 300px;
            display: inline-block;
        }

        .version-card h3 {
            margin-top: 0;
            font-size: 20px;
        }

        .choose-btn {
            background-color: #000000;
            color: #3dff17;
            border: 0px;
            border-radius: 5px;
            font-weight: 600;
            padding: 10px 20px;
            transition: 0.2s;
        }

        .choose-btn:active {
            transition: 0.0s !important;
            opacity: 25%;
        }




        h2 {
        color: white;
        font-weight: 800;
    }

    .btn {
        background-color: #000000;
        color: #3dff17;
        border: 0px;
        border-radius: 5px;
        font-weight: 600;
        padding: 10px 20px;
        transition: 0.2s;
    }

    .btn:active {
        transition: 0.0s !important;
        opacity: 10%;
    }

    input[type="text"] {
        width: 300px;
        height: 30px;
        background-color: #202020;
        color: white;
        border: 0px;
        border-radius: 10px;
        padding: 5px 10px;
    }

    input[type="text"]:focus {
        outline: none;
        background-color: #3dff17;
        color: white;
    }
    </style>
</head>
<body>
    <button class="btn" onclick="window.location.href='http://localhost:5000';">Back</button>

    
    <!-- Placeholder for displaying download progress -->
    <div id="progressMessage" style="display: none;">
        <h3 style="color:#858585">Installing, this may take a few minutes!</h3>
    </div>
    
    <script>
        function submitForm(event) {
            event.preventDefault(); // Prevent the default form submission
    
            var version = document.getElementById('versionInput').value;
    
            // Show progress message
            document.getElementById('progressMessage').style.display = 'block';
    
            // Send a POST request to the server in the background
            fetch('/versions/download', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ version: version })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                window.location.href = '/download_complete/' + encodeURIComponent(version);
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
    </script>
    <h2>Installed Versions</h2>

    <!-- Container for version cards -->
    <div id="version-cards-container">
        <!-- Version cards will be dynamically inserted here -->
        <form id="downloadForm" action="/versions/download" method="post" onsubmit="submitForm(event)">
            <input required="true" type="text" name="version" id="versionInput" placeholder="Enter a version to install" pattern="[0-9.]*">
            <button class="btn" type="submit">INSTALL</button>
        </form>
    </div>

    <script>
        // Function to handle the choose button click
        function chooseVersion(version) {
            fetch('/save_version', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ version: version })
            })
            .then(response => {
                if (response.ok) {
                    window.location.href = '/download_complete/' + encodeURIComponent(version);
                } else {
                    throw new Error('Failed to save version.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to save version.');
            });
        }

        // Function to dynamically create version cards
        function renderVersionCards(versions) {
            const container = document.getElementById('version-cards-container');

            versions.forEach(version => {
                const card = document.createElement('div');
                card.classList.add('version-card');
                card.innerHTML = `
                    <h3>${version}</h3>
                    <button class="choose-btn" onclick="chooseVersion('${version}')">Choose</button>
                `;
                container.appendChild(card);
            });
        }

        // Fetch versions from the server
        fetch('/get_versions')
            .then(response => response.json())
            .then(data => renderVersionCards(data.versions))
            .catch(error => console.error('Error fetching versions:', error));
    </script>

</body>
</html>
